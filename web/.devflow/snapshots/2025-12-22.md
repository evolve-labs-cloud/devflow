# Project Snapshot - 2025-12-22

## Overview

DevFlow IDE is a web-based IDE for spec-driven development, inspired by AWS Kiro. It integrates Claude Code CLI for AI-assisted coding with a modern dark-themed interface.

## Tech Stack

| Category | Technology |
|----------|------------|
| Framework | Next.js 16 (App Router) |
| Bundler | Turbopack |
| Language | TypeScript |
| State Management | Zustand |
| Code Editor | Monaco Editor |
| Terminal | xterm.js + node-pty |
| Styling | Tailwind CSS |
| UI Components | Radix UI, Lucide Icons |
| AI Integration | Claude Code CLI (subprocess) |
| Version Control | simple-git |

## Project Structure

```
web/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ chat/          # SSE streaming endpoint
â”‚   â”‚   â”œâ”€â”€ files/         # File tree and content API
â”‚   â”‚   â”œâ”€â”€ git/           # Git operations API
â”‚   â”‚   â”œâ”€â”€ search/        # File and content search API
â”‚   â”‚   â”œâ”€â”€ specs/         # Specs CRUD API
â”‚   â”‚   â””â”€â”€ terminal/      # PTY terminal sessions API
â”‚   â”œâ”€â”€ ide/               # Main IDE page
â”‚   â”œâ”€â”€ globals.css        # Global styles + animations
â”‚   â”œâ”€â”€ layout.tsx         # Root layout
â”‚   â””â”€â”€ page.tsx           # Home page
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ chat/              # Chat panel components
â”‚   â”‚   â”œâ”€â”€ AgentIcon.tsx  # SVG agent icons
â”‚   â”‚   â”œâ”€â”€ AgentSelector.tsx
â”‚   â”‚   â”œâ”€â”€ ChatMessage.tsx
â”‚   â”‚   â””â”€â”€ ChatPanel.tsx
â”‚   â”œâ”€â”€ editor/            # Monaco editor wrapper
â”‚   â”‚   â”œâ”€â”€ EditorPanel.tsx
â”‚   â”‚   â”œâ”€â”€ EditorTabs.tsx
â”‚   â”‚   â””â”€â”€ MonacoEditor.tsx
â”‚   â”œâ”€â”€ git/               # Git integration panel
â”‚   â”‚   â””â”€â”€ GitPanel.tsx
â”‚   â”œâ”€â”€ layout/            # Sidebar, StatusBar
â”‚   â”œâ”€â”€ modals/            # Global modals
â”‚   â”‚   â”œâ”€â”€ CommandPalette.tsx
â”‚   â”‚   â”œâ”€â”€ GlobalSearch.tsx
â”‚   â”‚   â””â”€â”€ QuickOpen.tsx
â”‚   â”œâ”€â”€ specs/             # SpecsPanel workflow
â”‚   â”œâ”€â”€ terminal/          # Real terminal with PTY
â”‚   â”‚   â””â”€â”€ TerminalPanel.tsx
â”‚   â””â”€â”€ ui/                # Shared UI components
â”‚
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useKeyboardShortcuts.ts  # Global keyboard shortcuts
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ stores/            # Zustand stores
â”‚   â”‚   â”œâ”€â”€ chatStore.ts
â”‚   â”‚   â”œâ”€â”€ fileStore.ts   # + scrollToLine
â”‚   â”‚   â”œâ”€â”€ gitStore.ts    # NEW
â”‚   â”‚   â”œâ”€â”€ projectStore.ts
â”‚   â”‚   â”œâ”€â”€ specsStore.ts
â”‚   â”‚   â””â”€â”€ uiStore.ts     # + modal states
â”‚   â”œâ”€â”€ git.ts             # Git utility functions
â”‚   â”œâ”€â”€ ptyManager.ts      # PTY session manager
â”‚   â”œâ”€â”€ specsParser.ts     # Markdown parser
â”‚   â”œâ”€â”€ types/             # TypeScript types
â”‚   â””â”€â”€ utils.ts           # Utilities (cn)
â”‚
â”œâ”€â”€ docs/                  # Documentation
â”‚   â”œâ”€â”€ architecture/      # Technical architecture
â”‚   â”œâ”€â”€ decisions/         # ADRs
â”‚   â””â”€â”€ planning/          # PRD and stories
â”‚
â””â”€â”€ .devflow/
    â””â”€â”€ snapshots/         # Project snapshots
```

## Features Status

| Feature | Status | Notes |
|---------|--------|-------|
| Project Management | âœ… Done | Open folders, recent projects |
| File Explorer | âœ… Done | Tree view, file operations |
| Monaco Editor | âœ… Done | Syntax highlighting, dark theme |
| Claude Chat | âœ… Done | SSE streaming, multi-agent |
| Specs Workflow | âœ… Done | Requirements, Design, Tasks |
| Dark Theme (Kiro) | âœ… Done | Purple accents, modern UI |
| Responsive Specs | âœ… Done | Mobile-friendly panels |
| Terminal | âœ… Done | Real PTY with xterm.js |
| Git Integration | âœ… Done | Full source control panel |
| Task Execution | âœ… Done | Run tasks with agents |
| Quick Open (Cmd+P) | âœ… Done | Fuzzy file search |
| Global Search (Cmd+Shift+F) | âœ… Done | Full-text search |
| Command Palette (Cmd+Shift+P) | âœ… Done | Quick commands |
| Keyboard Shortcuts | âœ… Done | Global shortcuts system |
| Knowledge Graph | ðŸ“‹ Planned | Coming soon |
| Dashboard | ðŸ“‹ Planned | Coming soon |

## Keyboard Shortcuts

| Shortcut | Action |
|----------|--------|
| Cmd/Ctrl + P | Quick Open |
| Cmd/Ctrl + Shift + F | Global Search |
| Cmd/Ctrl + Shift + P | Command Palette |
| Cmd/Ctrl + B | Toggle Sidebar |
| Cmd/Ctrl + ` | Toggle Terminal |
| Cmd/Ctrl + Shift + V | Toggle Preview |
| Cmd/Ctrl + S | Save File |
| Esc | Close Modals |

## API Endpoints

| Method | Path | Description |
|--------|------|-------------|
| POST | /api/chat | SSE streaming chat with Claude |
| GET | /api/specs | List all specs from project |
| POST | /api/specs | Create new spec (story/adr/spec) |
| GET | /api/files/tree | Get file tree for project |
| GET | /api/files/content | Read file content |
| POST | /api/files/content | Write file content |
| GET | /api/search?type=files | Quick Open file search |
| GET | /api/search?type=content | Global content search |
| GET | /api/git | Get git status |
| POST | /api/git | Git operations (commit, push, etc) |
| POST | /api/terminal/create | Create PTY session |
| GET | /api/terminal/stream | SSE for terminal output |
| POST | /api/terminal/write | Send input to terminal |
| POST | /api/terminal/resize | Resize terminal |
| DELETE | /api/terminal/[id] | Kill terminal session |

## Stores (Zustand)

| Store | Purpose |
|-------|---------|
| projectStore | Current project, recent projects |
| fileStore | File tree, open files, content, scrollToLine |
| uiStore | Sidebar, panels, modals, theme settings |
| chatStore | Messages, agents, streaming |
| specsStore | Specs, requirements, decisions, tasks |
| gitStore | Git status, branches, operations |

## Key Dependencies

```json
{
  "next": "16.x",
  "@monaco-editor/react": "latest",
  "zustand": "latest",
  "@radix-ui/*": "latest",
  "lucide-react": "latest",
  "tailwindcss": "latest",
  "xterm": "latest",
  "@xterm/addon-fit": "latest",
  "@xterm/addon-web-links": "latest",
  "node-pty": "latest",
  "simple-git": "latest"
}
```

## Recent Decisions

1. **ADR-001**: Kiro-style dark theme with purple accents
2. **ADR-002**: Markdown-based specs with frontmatter parsing
3. **ADR-003**: Claude CLI as backend (subprocess vs API)
4. **ADR-004**: Real PTY terminal with xterm.js + node-pty

## Known Issues

1. Image upload in chat is UI-only (not functional)
2. Autopilot mode is toggle only (no implementation)
3. Knowledge Graph panel shows "Coming soon"
4. Dashboard panel shows "Coming soon"

## Next Steps

1. Implement Knowledge Graph visualization (D3.js or React Flow)
2. Implement Dashboard with project metrics
3. Add Context Menu to File Explorer (right-click)
4. Add Mermaid diagrams support in markdown preview
5. Implement synchronized scroll (editor/preview)
6. Add automated tests (Vitest + Playwright)

## Changes Since Last Snapshot (2025-12-19)

### Added
- Real terminal with xterm.js and node-pty
- Git integration panel with full operations
- Task execution system with agent assignment
- Quick Open modal (Cmd+P)
- Global Search modal (Cmd+Shift+F)
- Command Palette (Cmd+Shift+P)
- Global keyboard shortcuts system
- Line navigation with highlight animation

### Fixed
- Agent icons consistency (now using SVG AgentIcon component)
- Monaco editor keyboard shortcuts (CtrlCmd fix)
- Claude CLI verbose flag for streaming

---

*Snapshot generated by @chronicler agent*
